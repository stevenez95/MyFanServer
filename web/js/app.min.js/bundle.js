var myMusic=angular.module("myMusic",["ngRoute","ngCookies"]);myMusic.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("AuthInterceptor")}]),myMusic.config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"templates/login.html",controller:"authCtrl"}).when("/register",{templateUrl:"templates/signup.html",controller:"authCtrl"}).when("/fan",{templateUrl:"templates/fan/fanDash.html",controller:"fanCtrl"}).when("/band",{templateUrl:"templates/banda/bandDash.html",controller:"bandCtrl"}).when("/band/:bandId/discos/:discId",{templateUrl:"templates/banda/discografia.html",controller:"discCtrl"}).when("/band/:bandId/discos/edit/:discId",{templateUrl:"templates/banda/discografia.html",controller:"editDiscCtrl"}).when("/fan/discos/:discId",{templateUrl:"templates/banda/discografia.html",controller:"discCtrl"}).when("/band/:bandId/conciertos/:eventId",{templateUrl:"templates/banda/concierto.html",controller:"concertCtrl"}).otherwise({redirectTo:"/"})}]),myMusic.controller("authCtrl",["$scope","$http","$location","$rootScope",function($scope,$http,$location,$rootScope){$scope.newFan={},$scope.newBand={},$scope.newFan.img="http://i.imgur.com/G3C6CE0.png",$scope.logUser={},$scope.error,$scope.registerBand=function(){console.log($scope.newBand)},$scope.registerFan=function(){console.log($scope.newFan),console.log($scope.newFan.bday)},$scope.login=function(){$rootScope.authenticated=!0,console.log($scope.logUser),$location.path("/fan"),$http.post("http://localhost:8080/prueba/webresources/generic",{image:"asda",username:"stevenez",password:"pass"}).then(function(data){console.log(data)},function(data){console.log(data)})},$scope.openLogIn=function(name){"Fan"===name?$scope.isFan=!0:$scope.isFan=!1},$scope.signout=function(){$rootScope.authenticated=!1}}]),myMusic.controller("bandCtrl",["$scope",function($scope){}]),myMusic.controller("concertCtrl",["$scope","$routeParams",function($scope,$routeParams){$scope.userType="band",$scope.discId=$routeParams.eventId,$scope.bandId=$routeParams.bandId,$scope.viewDisc=function(){$scope.discInfo={}},$scope.deleteDisc=function(){$scope.discInfo=null},$scope.editSong=function(){},$scope.deleteSong=function(){}}]),myMusic.controller("editDiscCtrl",["$scope","$routeParams",function($scope,$routeParams){$scope.type="edit",$scope.discId=$routeParams.discId}]),myMusic.controller("discCtrl",["$scope","$routeParams",function($scope,$routeParams){$scope.type="view",$scope.userType="band",$scope.discId=$routeParams.discId,$scope.bandId=$routeParams.bandId,$scope.viewDisc=function(){$scope.discInfo={}},$scope.deleteDisc=function(){$scope.discInfo=null},$scope.editSong=function(){},$scope.deleteSong=function(){}}]),myMusic.controller("fanCtrl",["$scope","$location",function($scope,$location){}]),myMusic.controller("mainCtrl",["$scope","$location","$anchorScroll",function($scope,$location,$anchorScroll){$location.path("/"),$scope.scrollTo=function(id){$location.hash(id),$anchorScroll()}}]),myMusic.factory("Auth",["$http","AuthToken",function($http,AuthToken){var authFactory={};return authFactory.login=function(username,password){console.log("loginnnn!!")},authFactory.logout=function(){AuthToken.setToken()},authFactory.isLoggedIn=function(){return!!AuthToken.getToken()},authFactory}]),myMusic.factory("AuthToken",["$cookies",function($cookies){var authTokenFactory={};return authTokenFactory.getToken=function(){return $cookies.getObject("token")},authTokenFactory.setToken=function(token){token?$cookies.putObject("token",token):$cookies.remove("token")},authTokenFactory}]),myMusic.factory("AuthInterceptor",["$q","$location","AuthToken",function($q,$location,AuthToken){var interceptorFactory={};return interceptorFactory.request=function(config){var token=AuthToken.getToken();return token&&(config.headers["x-access-token"]=token),config},interceptorFactory.responseError=function(response){return 403===response.status&&(AuthToken.setToken(),$location.path("/login")),$q.reject(response)},interceptorFactory}]);